!function(e){var i={paymentFields:Object(),init:function(){var t=e("#user_registration_enable_paypal_standard_subscription"),n=e(".ur-selected-item").find(".ur-input-type-subscription_plan").length,a=e("#user_registration_paypal_plan_name_field"),r=e("#user_registration_paypal_interval_count_field"),o=e("#user_registration_paypal_recurring_period_field");t.is(":checked")?n>0?(a.hide(),r.hide(),o.hide()):(a.show(),r.show(),o.show()):(a.hide(),r.hide(),o.hide()),e(document).on("user_registration_handle_selected_item",function(i,t){if("subscription_plan"===e(t).find(".ur-field").data("field-key")){var n=e(".ur-selected-item").find(".ur-input-type-subscription_plan").length,a=e("#user_registration_paypal_plan_name_field"),r=e("#user_registration_paypal_interval_count_field"),o=e("#user_registration_paypal_recurring_period_field");n>0?(a.hide(),r.hide(),o.hide()):(a.show(),r.show(),o.show())}}),e(document).on("user_registration_admin_before_form_submit",function(e,t){var n=i.save_conditional_logic_settings(),a=i.save_conditional_logic_settings_mollie(),r=i.check_supported_currency();void 0!==r&&r.length>0&&(t.data.ur_invalid_currency_status=r),n.length>0&&(t.data.ur_paypal_conditional_integration=n),a.length>0&&(t.data.ur_mollie_conditional_integration=a);var o=i.check_locked_payment_fields(t);void 0!==o&&o.length>0&&(t.data.ur_payment_disabled=o.ur_payment_disabled),t.data.payment_field_present=i.check_payment_field_exists()}),e(document).on("ur_new_field_created",function(i,t){"subscription_plan"===t.fieldName&&(e("#user_registration_stripe_plan_name_field").hide(),e("#user_registration_stripe_interval_count_field").hide(),e("#user_registration_stripe_recurring_period_field").hide(),e("#user_registration_paypal_plan_name_field").hide(),e("#user_registration_paypal_interval_count_field").hide(),e("#user_registration_paypal_recurring_period_field").hide())}),e("#user_registration_enable_paypal_standard_subscription").on("change",function(){var i=e("#user_registration_enable_paypal_standard_subscription"),t=e(".ur-selected-item").find(".ur-input-type-subscription_plan").length,n=e("#user_registration_paypal_plan_name_field"),a=e("#user_registration_paypal_interval_count_field"),r=e("#user_registration_paypal_recurring_period_field");i.is(":checked")?t>0?(n.hide(),a.hide(),r.hide()):(n.show(),a.show(),r.show()):(n.hide(),a.hide(),r.hide())}).trigger("change"),i.init_payment_field_triggers()},save_conditional_logic_settings:function(){var i=new Array,t=e("div[data-source='paypal']").closest(".ur_conditional_logic_container"),n=e(t).find(".ur-conditional-wrapper"),a=e(t).find("#ur_use_conditional_logic").val(),r=(a=e(t).find("#ur_use_conditional_logic").is(":checked"),{});e.each(n,function(i,t){r.conditional_field=e(this).find(".ur_conditional_field").val(),r.conditional_operator=e(this).find(".ur-conditional-condition").val(),r.conditional_value=e(this).find(".ur-conditional-input").val()});var o={enable_conditional_logic:a,conditional_logic_data:r};return i.push(o),i},save_conditional_logic_settings_mollie:function(){var i=new Array,t=e("div[data-source='mollie']").closest(".ur_conditional_logic_container"),n=e(t).find(".ur-conditional-wrapper"),a=e(t).find("#ur_use_conditional_logic").val(),r=(a=e(t).find("#ur_use_conditional_logic").is(":checked"),{});e.each(n,function(i,t){r.conditional_field=e(this).find(".ur_conditional_field").val(),r.conditional_operator=e(this).find(".ur-conditional-condition").val(),r.conditional_value=e(this).find(".ur-conditional-input").val()});var o={enable_conditional_logic:a,conditional_logic_data:r};return i.push(o),i},init_payment_field_triggers:function(){i.init_quantity_fields(),i.init_coupon_fields(),i.sanitize_price_inputs(),i.sanitize_inputs()},init_coupon_fields:function(){e(document).on("focus",".ur-coupon-settings-target_field",function(){i.get_payment_fields("coupon"),i.render_payment_fields(e(this),"coupon")})},init_quantity_fields:function(){e(document).on("focus",".ur-settings-target_field",function(){i.get_payment_fields("quantity"),i.render_payment_fields(e(this),"quantity")})},render_payment_fields:function(t,n){var a=e(".ur-item-active .ur-advance-setting-block"),r="coupon"===n?".ur-coupon-settings-target_field":".ur-settings-target_field",o=a.find(r).val();t.empty(),t.append(e("<option></option>").attr("value","").text(ur_payment_params.select_field_text));var l=this.get_selected_all_target_fields();e.each(i.paymentFields,function(i,a){"quantity"===n?-1==e.inArray(i,l)?t.append(e("<option></option>").attr("value",i).text(a)):(t.append(e("<option class='disabled-option' disabled></option>").attr("value",i).text(a).prop("disabled",!0)),t.find(".disabled-option").css("background-color","#ccc")):t.append(e("<option></option>").attr("value",i).text(a))}),t.find("option[value='"+o+"']").attr("selected","selected").removeAttr("disabled"),t.find("option[value='"+o+"']").attr("selected","selected").css("background-color","transparent");var u=a.find("select"+r);u.html(t.html()).val(t.val()),u.find(":selected").attr("selected","selected")},get_selected_all_target_fields:function(){var i=e(".ur-selected-item .ur-advance-setting-block"),t=[];return i.length&&i.each(function(){var i=e(this).find(".ur-settings-target_field").val();-1==e.inArray(i,t)&&i!==undefined&&""!==i&&t.push(i)}),t},get_payment_fields:function(t){if("coupon"===t)var n=e(".ur-input-grids").find(".ur-input-type-single-item,.ur-input-type-total-field");else n=e(".ur-input-grids").find(".ur-input-type-single-item, .ur-input-type-multiple_choice, .ur-payment-enabled-slider");return i.paymentFields={},n.length&&n.each(function(){var t=e(this).parent().find(".ur-general-setting-block").find("input[data-field='field_name'").val();i.paymentFields[t]=e(this).find(".ur-label label").text()}),i.paymentFields},sanitize_price_inputs:function(){e(document).on("input",".ur-price-input, .ur-type-checkbox-money-input, .ur-selling-price-input, .ur-checkbox-selling-price-input",function(i){var t=e(this),n=t.val();n=n.replace(/[^0-9.]/g,""),t.val(n)}),e(document).on("focusout",".ur-price-input, .ur-type-checkbox-money-input, .ur-selling-price-input, .ur-checkbox-selling-price-input",function(i){var t=e(this).val();(isNaN(t)||""===t)&&(t="0.00"),e(this).val(t)}),e(document).on("input",".ur-selling-price-input",function(t){var n=e(this).closest(".ur-toggle-content").find(".ur-price-input");i.compare_price_value(e(this),n)}),e(document).on("input",".ur-price-input",function(t){var n=e(this).closest(".ur-toggle-content").find(".ur-selling-price-input");i.compare_price_value(n,e(this))}),e(document).on("input",".ur-checkbox-selling-price-input",function(t){var n=e(this).closest("li.ur-multiple-choice ").find(".ur-type-checkbox-money-input");i.compare_price_value(e(this),n)}),e(document).on("input",".ur-checkbox-selling-price-input",function(t){var n=e(this).closest("li.ur-subscription-plan ").find(".ur-type-radio-money-input");i.compare_price_value(e(this),n)}),e(document).on("input",".ur-type-radio-money-input",function(t){var n=e(this).closest("li.ur-subscription-plan ").find(".ur-checkbox-selling-price-input");i.compare_price_value(n,e(this))}),e(document).on("input",".ur-type-checkbox-money-input",function(t){var n=e(this).closest("li.ur-multiple-choice ").find(".ur-checkbox-selling-price-input");i.compare_price_value(n,e(this))})},sanitize_inputs:function(){e(document).on("input","#user_registration_paypal_interval_count_field",function(){var i=e(this),t=i.val();t=t.replace(/[^0-9]/g,""),t=parseInt(t),(isNaN(t)||0===t)&&(t=1),i.val(t)})},check_supported_currency:function(){var i=[],t=e("#user_registration_enable_paypal_standard"),n=e("#user_registration_enable_stripe"),a=e("#user_registration_enable_authorize_net");if(t.is(":checked")&&!n.is(":checked")&&!a.is(":checked")){var r=ur_payment_params.is_valid_currency.is_invalid,o=ur_payment_params.is_valid_currency.currency,l=ur_payment_params.invalid_currency_message;if(invalid_message=l.replace("%CODE%",o),r){var u={validation_status:!1,validation_message:invalid_message};return i.push(u),i}}},compare_price_value:function(e,i){var t=parseInt(e.val()),n=parseInt(i.val());e.tooltipster({trigger:"custom",triggerOpen:{keyup:!0},triggerClose:{keyup:!0},content:ur_payment_params.compare_selling_regular_price_message,multiple:!0,theme:"ur-selling-price-tooltip"}),t>n?(e.tooltipster("open"),e.css("border-color","#f99494")):(e.tooltipster("close"),e.css("border-color","#e1e1e1"))},check_locked_payment_fields:function(t){var n=!1,a=!1,r=!1,o=!1;return i.get_payment_fields(),e.each(t.data.form_setting_data,function(e,i){"user_registration_enable_paypal_standard"===i.name&&(n=i.value),"user_registration_enable_stripe"===i.name&&(a=i.value),"user_registration_enable_authorize_net"===i.name&&(r=i.value),"user_registration_enable_mollie"===i.name&&(o=i.value)}),!n&&Object.keys(i.paymentFields).length>0&&(a||r||o||(t.data.ur_payment_disabled=[{validation_status:!1,validation_message:ur_payment_params.payments_disabled_message}])),t},check_payment_field_exists:function(){return e(".ur-input-grids").find(".ur-input-type-single-item, .ur-input-type-multiple_choice, .ur-payment-enabled-slider , .ur-input-type-stripe-gateway, .ur-input-type-quantity-field, .ur-input-type-subscription_plan, .ur-input-type-coupon-field, .ur-input-type-total-field, .ur-input-type-stripe-gateway, .ur-input-type-authorize-net-gateway, .ur-input-type-mollie-gateway").length>0}};e(document).ready(function(){i.init()})}(jQuery);