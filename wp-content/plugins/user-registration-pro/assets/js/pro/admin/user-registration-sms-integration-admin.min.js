!function(n){var t={init:function(){n(".ur_sms_integration_account_action_button").on("click",function(){var t=n(this).closest(".sms_integration-wrapper"),i=n("#ur_twilio_client_number").val(),e=n("#ur_twilio_client_id").val(),a=n("#ur_twilio_client_auth").val(),o=new FormData;o.append("ur_twilio_client_number",i),o.append("ur_twilio_client_id",e),o.append("ur_twilio_client_auth",a),o.append("action","user_registration_sms_integration_connection_action"),o.append("security",ur_sms_integration_params.ur_sms_integration_connection_save),n.ajax({url:ur_sms_integration_params.ajax_url,dataType:"json",cache:!1,contentType:!1,processData:!1,data:o,type:"post",beforeSend:function(){n(".ur_sms_integration_account_action_button").append('<span class="ur-spinner is-active"></span>')},complete:function(i){n(".ur_sms_integration_account_action_button").find(".ur-spinner").remove();var e=t.find(".ur-integration-connected-accounts");if(!0===i.responseJSON.success){var a=i.responseJSON.data.new_connection,o="";0<e.length?(o+="<li>",o+='<div class="ur-integration-connected-accounts--label"><strong> '+a.label+"</strong></div>",o+='<div class="ur-integration-connected-accounts--date">Connected on '+a.date+"</div>",o+='<div class="ur-integration-connected-accounts--disconnect">',o+="<a href='#' class='disconnect ur-sms_integration-disconnect-account' data-key='"+a.client_number+"' > "+ur_sms_integration_params.i18n_disconnect+"</a>",o+="</div>",o+="</li>",e.append(o)):(o+='<div id="sms_integration_accounts" class="postbox">',o+='<ul class="ur-integration-connected-accounts">',o+="<li>",o+='<div class="ur-integration-connected-accounts--label"><strong> '+a.label+"</strong></div>",o+='<div class="ur-integration-connected-accounts--date">Connected on '+a.date+"</div>",o+='<div class="ur-integration-connected-accounts--disconnect">',o+="<a href='#' class='disconnect ur-sms_integration-disconnect-account' data-key='"+a.client_number+"' > "+ur_sms_integration_params.i18n_disconnect+"</a>",o+="</div>",o+="</li>",o+="</ul>",o+="</div>",n(".sms_integration-wrapper").append(o),n(".sms_integration-wrapper").closest(".user-registration-card").find(".integration-status").addClass("ur-integration-account-connected")),n(".ur-sms_integration_notice").remove(),n("#ur_twilio_client_number").val(""),n("#ur_twilio_client_id").val(""),n("#ur_twilio_client_auth").val("")}else{n(".ur-sms_integration_notice").remove();var s='<div id="message" class="error inline ur-sms_integration_notice"><p><strong>'+i.responseJSON.data.message+"</strong></p></div>";t.closest(".ur-export-users-page").prepend(s)}}})}),n(document).on("click",".ur-sms_integration-disconnect-account",function(n){t.disconnect_connection(this,n)}),n(document).on("user_registration_admin_before_form_submit",function(i,e){var a=n("#ur_sms_integration_account").val(),o=t.save_sms_integration_form_settings(a);void 0!==a&&(e.data.ur_sms_integration_integration=o)}),n(document).on("change","#ur_sms_integration_integration_list_id",function(){var t=n(".ur_sms_integration_fields .column-form-fields").find("select");n.each(t,function(){"user_email"!=n(this).val()&&n(this).prop("selectedIndex",0)})})},disconnect_connection:function(t,i){i.preventDefault();var e=n(t);data={action:"user_registration_sms_integration_connection_disconnect_action",security:ur_sms_integration_params.ur_sms_integration_connection_disconnect,client_number:e.data("key")},ur_confirmation(user_registration_form_builder_data.i18n_admin.i18n_are_you_sure_want_to_delete_row,{title:user_registration_form_builder_data.i18n_admin.i18n_msg_delete,confirm:function(){n.ajax({url:ur_sms_integration_params.ajax_url,method:"POST",data:data}).done(function(t){!0===t.success?Swal.fire({icon:"success",title:t.data.message,customClass:"user-registration-swal2-modal user-registration-swal2-modal--center",showConfirmButton:!1,timer:1e3}).then(function(n){window.location.reload()}):(Swal.showValidationMessage(t.data.message),n(".swal2-actions").removeClass("swal2-loading"),n(".swal2-actions").find("button").prop("disabled",!1))})},reject:function(){}})},save_sms_integration_form_settings:function(t){var i=n("#ur_sms_integration_integration_list_id").val(),e=n(".ur_sms_integration_fields table select"),a=n("#ur_sms_integration_double_optin").is(":checked"),o={};n.each(e,function(n,t){o[t.id]=t.value});var s=n("div[data-source='sms_integration']").closest(".ur_conditional_logic_container"),r=n(s).find(".ur-conditional-wrapper"),c=n(s).find("#ur_use_conditional_logic").is(":checked"),_={};return n.each(r,function(t,i){_.conditional_field=n(s).find(".ur_conditional_field").val(),_.conditional_operator=n(s).find(".ur-conditional-condition").val(),_.conditional_value=n(s).find(".ur-conditional-input").val()}),{client_number:t,list_id:i,list_fields:JSON.stringify(o),double_optin:a,enable_conditional_logic:c,conditional_logic_data:_}}};n(document).ready(function(){t.init()})}(jQuery);