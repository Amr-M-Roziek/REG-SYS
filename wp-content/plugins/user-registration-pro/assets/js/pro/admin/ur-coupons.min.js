!function(e,n){if(UR_Snackbar)var o=new UR_Snackbar;var t={format_data_key_name:function(e){return e.replace("_"," ").split(" ").map(function(e){return e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()}).join(" ")},convert_to_array:function(e){return Object.values(e).reverse().slice(2).reverse()},append_spinner:function(e){if(e&&e.append){return e.append('<span class="ur-spinner is-active"></span>'),!0}return!1},prepend_spinner:function(e){if(e&&e.prepend){return e.prepend('<span class="ur-spinner is-active"></span>'),!0}return!1},remove_spinner:function(e){return!(!e||!e.remove)&&(e.find(".ur-spinner").remove(),!0)},if_empty:function(e,n){return null===e||undefined===e||""===e?n:e},toggleSaveButtons:function(n){n=this.if_empty(n,!0),e(".save-coupon-btn").prop("disabled",!!n)},show_success_message:function(e){return!!o&&(o.add({type:"success",message:e,duration:5}),!0)},show_failure_message:function(e){return!!o&&(o.add({type:"failure",message:e,duration:6}),!0)}},a={prepare_coupons_data:function(){var n={},o=e(".ur-coupon-input"),a=[];return(o=t.convert_to_array(o)).forEach(function(o){var t=e(o),a=t.data("key-name").toLowerCase();n[a]=t.is('input[type="checkbox"]')?t.prop("checked"):t.val()}),n.coupon_discount_type=e('input[name="ur_coupon_discount_type"]:checked').val(),n.coupon_for=e("#ur-input-type-coupon-for option:selected").val(),a="fixed"===n.coupon_discount_type?n.coupon_discount.match(/(?<=\$)\d+(\.\d+)?/):n.coupon_discount.match(/^\d+(\.\d+)?%$/),n.coupon_discount=parseFloat(a[0]).toFixed(2),"empty"===n.coupon_for?(delete n.coupon_form,delete n.coupon_membership):"form"===n.coupon_for?delete n.coupon_membership:"membership"===n.coupon_for&&delete n.coupon_form,n},validate_coupon_form:function(){var o=e("#ur-coupon-create-form").find("input"),a=!0;(o=t.convert_to_array(o)).every(function(o){var i=e(o),s=i.val(),r=i.attr("required"),u=i.data("key-name");if(r&&""===s)return a=!1,u=t.format_data_key_name(u),t.show_failure_message(n.labels.i18n_error+"! "+u+" "+n.labels.i18n_field_is_required),!1;if("end_date"===u){if(s<e("#ur-coupon-create-form").find("#ur-input-type-coupon-start-date").val())return a=!1,t.show_failure_message(n.labels.i18n_end_date_validation),!1}if("coupon_discount_type_percent"===u&&i.is(":checked")){if(null===(c=e("#ur-input-type-coupon-discount-type").val().match(/^\d+(\.\d+)?(?=%$)/)))return a=!1,t.show_failure_message(n.labels.i18n_amount_type_validation),!1;if(parseInt(c[0])>100)return a=!1,t.show_failure_message(n.labels.i18n_percent_limit_validation),!1}if("coupon_discount_type_fixed"===u&&i.is(":checked")){var c=e("#ur-input-type-coupon-discount-type").val().match(/(?<=\$)\d+(\.\d+)?/);if(isNaN(parseFloat(c)))return a=!1,t.show_failure_message(n.labels.i18n_amount_type_validation),!1}return!0});var i=e("#ur-input-type-coupon-for option:selected").val();if("empty"!==i)if("form"===i){var s=e("#ur-input-type-coupon-form option:selected").val();undefined!==s&&""!==s||(a=!1,t.show_failure_message(n.labels.i18n_applicable_for_form_validation))}else if("membership"===i){var r=e("#ur-input-type-coupon-membership option:selected").val();undefined!==r&&""!==r||(a=!1,t.show_failure_message(n.labels.i18n_applicable_for_membership_validation))}return a},create_coupon:function(o){if(t.toggleSaveButtons(!0),t.append_spinner(o),this.validate_coupon_form()){var a=this.prepare_coupons_data();this.send_data({action:"user_registration_coupons_create",coupons_data:JSON.stringify(a)},{success:function(o){o.success?(n.coupon_id=o.data.coupon_id,e(".save-coupon-btn").text("Save Coupon"),t.show_success_message(o.data.message)):t.show_failure_message(o.data.message)},failure:function(e,o){t.show_failure_message(n.labels.network_error+"("+o+")")},complete:function(){t.remove_spinner(o),t.toggleSaveButtons(!1)}})}else t.remove_spinner(o),t.toggleSaveButtons(!1)},update_coupon:function(e){if(t.toggleSaveButtons(!0),t.append_spinner(e),this.validate_coupon_form()){var o=this.prepare_coupons_data();this.send_data({action:"user_registration_coupons_update",coupon_id:n.coupon_id,coupons_data:JSON.stringify(o)},{success:function(e){e.success?(n.coupon_id=e.data.coupon_id,t.show_success_message(e.data.message)):t.show_failure_message(e.data.message)},failure:function(e,o){t.show_failure_message(n.labels.network_error+"("+o+")")},complete:function(){t.remove_spinner(e),t.toggleSaveButtons(!1)}})}else t.remove_spinner(e),t.toggleSaveButtons(!1)},send_data:function(o,t){var a="function"==typeof t.success?t.success:function(){},i="function"==typeof t.failure?t.failure:function(){},s="function"==typeof t.beforeSend?t.beforeSend:function(){},r="function"==typeof t.complete?t.complete:function(){};!o._wpnonce&&n&&(o._wpnonce=n._nonce),e.ajax({type:"post",dataType:"json",url:n.ajax_url,data:o,beforeSend:s,success:a,error:i,complete:r})},handle_bulk_delete_action:function(o){Swal.fire({title:'<img src="'+n.delete_icon+'" id="delete-user-icon">'+n.labels.i18n_prompt_title,html:'<p id="html_1">'+n.labels.i18n_prompt_bulk_subtitle+"</p>",showCancelButton:!0,confirmButtonText:n.labels.i18n_prompt_delete,cancelButtonText:n.labels.i18n_prompt_cancel,allowOutsideClick:!1}).then(function(i){if(i.isConfirmed){var s=o.find('input[name="coupon[]"]:checked'),r=[];if(s.length<1)return void t.show_failure_message(n.labels.i18n_prompt_no_membership_selected);s.each(function(){""!==e(this).val()&&r.push(e(this).val())}),a.send_data({action:"user_registration_coupons_delete_coupons",coupons_ids:JSON.stringify(r)},{success:function(e){e.success?(t.show_success_message(e.data.message),a.remove_deleted_coupons(s,!0)):t.show_failure_message(e.data.message)},failure:function(e,o){t.show_failure_message(n.labels.network_error+"("+o+")")},complete:function(){window.location.reload()}})}})},remove_deleted_coupons:function(n,o){o?n.each(function(){e(this).parents("tr").remove()}):e(n).parents("tr").remove()}};e(document).ready(function(){var o=e("#ur-input-type-coupon-for");o.select2({minimumResultsForSearch:-1,placeholder:n.labels.i18n_select_dropdown}),e(".coupon-enhanced-select2").select2({maximumSelectionSize:1,minimumResultsForSearch:-1,multiple:!0}),o.on("change",function(){var n=e(this).find("option:selected").val(),o=e(".coupon-hidden-select");o.each(function(n,o){e(o).removeClass("ur-d-flex").addClass("ur-d-none")}),o.each(function(o,t){e(t).data("value")===n&&e(t).removeClass("ur-d-none").addClass("ur-d-flex")})}),e(".save-coupon-btn").on("click",function(o){o.preventDefault(),o.stopPropagation();var t=e(this);""===n.coupon_id?a.create_coupon(t):a.update_coupon(t)}),e('input[name="ur_coupon_discount_type"]').on("change",function(){var o=e("#ur-input-type-coupon-discount-type"),t=e(this),a=o.val();if(""!==a)if("percent"===t.val()){var i=a.match(/(?<=\$)\d+(\.\d+)?/);null==i&&(i=a.match(/^\d+(\.\d+)?%$/));var s=null===i?a:i;o.val(parseFloat(s).toFixed(2)+"%")}else{var r=[];null==a.match(/\$.*/)&&(null!==(r=a.match(/^\d+(\.\d+)?%$/))?o.val(n.global_currency_symbol+parseFloat(r[0]).toFixed(2)):o.val(n.global_currency_symbol+parseFloat(a).toFixed(2)))}}).filter(":checked").trigger("change"),e("#ur-input-type-coupon-discount-type").on("change",function(){e('input[name="ur_coupon_discount_type"]:checked').trigger("change")}),e("#delete-coupon .submitdelete").on("click",function(o){o.preventDefault(),o.stopPropagation();var t=e(this);Swal.fire({title:'<img src="'+n.delete_icon+'" id="delete-user-icon">'+n.labels.i18n_prompt_title,html:'<p id="html_1">'+n.labels.i18n_prompt_single_subtitle+"</p>",showCancelButton:!0,confirmButtonText:n.labels.i18n_prompt_delete,cancelButtonText:n.labels.i18n_prompt_cancel,allowOutsideClick:!1}).then(function(n){n.isConfirmed&&e(location).attr("href",t.attr("href"))})}),e("#ur-coupon-list-form #doaction,#doaction2").on("click",function(n){n.preventDefault(),n.stopPropagation();var o=e("#ur-coupon-list-form");switch(o.find("select#bulk-action-selector-top option:selected").val()){case"trash":a.handle_bulk_delete_action(o)}})})}(jQuery,window.ur_coupons_localized_data);