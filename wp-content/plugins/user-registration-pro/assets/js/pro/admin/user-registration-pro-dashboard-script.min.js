jQuery(function(r){function a(r){"login"===r.val()?r.closest("#mainform").find("select[name='user_registration_pro_popup_registration_form']").closest(".user-registration-global-settings").hide():r.closest("#mainform").find("select[name='user_registration_pro_popup_registration_form']").closest(".user-registration-global-settings").show()}var t={data:{formId:0,duration:"",from:"",to:"",summarySortBy:"",summarySortOrder:"desc",summaryCurrentPage:1,summaryLimit:10,popupActive:!1},charts:{},responseData:{},init:function(){this.dashboard_load_event()},dashboard_load_event:function(){r(document).ready(function(){r(".user-registration-pro-dashboard-select-form").trigger("change"),r(".user-registration-pro-date-switcher").on("click",function(){if(!r(this).hasClass("is-active")){r(this).addClass("is-active");var a=r(this).attr("class").split(" ")[3];r(".user-registration-pro-date-switcher:not(."+a+")").removeClass("is-active"),r("#date-range-selector").val(""),r(".user-registration-pro-dashboard-select-form").trigger("change")}});var a={};r(".user-registration-pro-date-range-selector").on("click",function(){var t=r(this).data("id"),e=a[t];e||(e=r(this).flatpickr({mode:"range",disableMobile:!0,dateFormat:"Y-m-d","static":!0,onClose:function(a,t,e){0!==a.length&&(r(".user-registration-pro-date-switcher").removeClass("is-active"),t!==r(".user-registration-pro-date-checker").val()&&(r(".user-registration-pro-date-checker").val(t),r(".user-registration-pro-dashboard-select-form").trigger("change")))},onOpen:function(a,t,e){e.clear(),r(".user-registration-pro-date-checker").val("")}}),a[t]=e),e&&e.open()})}),r(".user-registration-pro-dashboard-select-form").on("change",function(){r(".user-registration-pro-dashboard__body").html(user_registration_pro_dashboard_script_data.dashboard_page_template),"all"!==r(this).val()&&r(document).find(".user-registration-registration-source-report").remove(),t.data.duration="Week";var a="";r(".user-registration-pro-date-switcher").each(function(){var e=r("#date-range-selector").val(),o=e.split("to");t.data.from=o[0],t.data.to=o[1],""!==e&&e.indexOf("to")<0?t.data.duration="":r(this).hasClass("is-active")?a=r(this).html():t.data.duration=e}),""!==a&&(t.data.duration=a),t.data.formId=r(this).val();var e={action:"user_registration_pro_dashboard_analytics",form_id:t.data.formId,selected_date:t.data.duration,duration:t.data.duration,from:t.data.from,to:t.data.to,summary_sort_by:t.data.summarySortBy,summary_sort_order:t.data.summarySortOrder,chart_type:"registration_count"};t.fetch_analytics_report(e)})},fetch_analytics_report:function(a){r.ajax({url:user_registration_pro_dashboard_script_data.ajax_url,data:a,type:"POST",success:function(e){t.responseData=e.data;var o=e.data.message;switch(a.chart_type){case"registration_count":r(".user-registration-pro-dashboard__body").find(".user-registration-registration-count-report").html(o),r(".user-registration-pro-dashboard__body").find(".user-registration-registration-overview-report").html(e.data.registration_overview);var s=e.data.user_report.weekly_data.daily_data,i=r(document).find("#user-registration-pro-registration-overview-chart-report-area"),n=Object.keys(s),d=[],l=[],u=[],c=[];n.forEach(function(r){d.push(s[r].new_registration_in_a_day),l.push(s[r].approved_users_in_a_day),u.push(s[r].pending_users_in_a_day),c.push(s[r].denied_users_in_a_day)});var p={datasets:[{label:"New User Registration",fill:!1,borderColor:"red",data:d},{label:"Approved Users",fill:!1,borderColor:"blue",data:l},{label:"Pending Users",fill:!1,borderColor:"#800020",data:u}],labels:n},m=new Chart(i,{type:"line",data:p,options:{responsive:!0,legend:{display:!1},scales:{xAxes:[{ticks:{maxTicksLimit:10}}]},legendCallback:function(r){var a=[];a.push('<ul class="user-registration-pro-legend-'+r.id+' ur-d-flex ur-flex-wrap ur-mt-3 ur-mb-0">');for(var t=0;t<3;t++)a.push('<li><span class="user-registration-pro-color-tag" style="background-color:'+r.data.datasets[t].borderColor+'"></span>'),r.data.datasets[t].label&&a.push(r.data.datasets[t].label),a.push("</li>");return a.push("</ul>"),a.join("")}}});r(".user-registration-total-registration-chart").find(".user-registration-pro-registration-overview-chart-report-legends").html(m.setDatasetVisibility(1,!0)),"all"===a.form_id?(a.chart_type="specific_form_users",t.fetch_analytics_report(a)):(a.chart_type="form_analytics_report",t.fetch_analytics_report(a));break;case"specific_form_users":t.specific_registration_source_chart(e.data),a.chart_type="form_analytics_report",t.fetch_analytics_report(a);break;case"form_analytics_report":t.populateISCALineChart(e),a.chart_type="top_referer_report",t.fetch_analytics_report(a);break;case"top_referer_report":t.populateTopRefererPages(e),a.chart_type="form_summary_report",t.fetch_analytics_report(a);break;case"form_summary_report":t.populateSummaryTable()}}})},populateTopRefererPages:function(a){var t="";r(".user-registration-form-analytics-referer-report").html(a.data.message),a.data.top_referer_pages.length>0?a.data.top_referer_pages.forEach(function(r){t+="<li>"+r.title+"<a href='"+r.url+"' rel='noreferrer noopener' target='_blank'> <i class='dashicons dashicons-external'></i></a></li>"}):t+="No referer pages found.",r(".urfa-list").html(t)},populateISCALineChart:function(a){r(".user-registration-form-analytics-overview-report").html(a.data.message);var e=r("#user-registration-pro-form-analytics-overview-chart-report-area");t.charts.iscaChart=new Chart(e,{type:"line",data:{},options:{responsive:!0,maintainAspectRatio:!1,plugins:{title:{display:!0}}}});var o=a.data.isca.data,s={labels:a.data.isca.labels,datasets:[{label:"Completed",data:o.map(function(r){return r.submitted_count}),borderWidth:2,fill:!0,borderColor:"#2ecc71",backgroundColor:"#e8faf0"},{label:"Abandoned",data:o.map(function(r){return r.abandoned_count}),borderWidth:2,fill:!0,borderColor:"#9b59b6",backgroundColor:"#f2e9ff"},{label:"Bounced",data:o.map(function(r){return r.bounced_count}),borderWidth:2,fill:!0,borderColor:"#3498db",backgroundColor:"#f6fbfc"},{label:"Impressions",data:o.map(function(r){return r.total_count}),borderColor:"#6c757d",backgroundColor:"#e3e8ec",borderWidth:2,fill:!0}]};t.charts.iscaChart.data=s,t.charts.iscaChart.update()},populateSummaryTable:function(){r(".user-registration-form-analytics-summary-report").html(t.responseData.message);var a=r(document).find("#urfa-forms-summary-table"),e=t.responseData.form_summary;"all"===t.data.formId&&(t.data.formId=0);var o=e.filter(function(r){return 0==r.form_id});e=e.filter(function(r){return 0!=r.form_id}),r(document).find("#urfa-summary-table-total-count").html(e.length);var s=t.data.summaryLimit;if(e.length>s){var i=t.data.summaryCurrentPage,n=parseInt(i-1)*s,d=n+s;d=d<e.length?d:e.length,e=e.slice(n,d),t.populateSummaryTablePagination()}var l="";r.each(e,function(r,a){var e="";a.form_id==t.data.formId&&(e="urfa-active-form-row");var o='<tr class="'+e+'"data-summary-form-id="'+a.form_id+'">';o+="<td>"+a.name+"</td>",o+="<td>"+a.total_count+"</td>",o+="<td>"+a.submitted_count+"</td>",o+="<td>"+a.conversion_rate+"%</td>",o+="<td>"+a.abandoned_count+"</td>",o+="<td>"+a.abandonment_rate+"%</td>",o+="<td>"+a.bounce_rate+"%</td>",l+=o+="</tr>"}),a.find("tbody").html(l);var u="";r.each(o,function(r,a){var e="";a.form_id==t.data.formId&&(e="urfa-active-form-row");var o='<tr class="'+e+'" data-summary-form-id="'+a.form_id+'">';o+="<td>"+a.name+"</td>",o+="<td>"+a.total_count+"</td>",o+="<td>"+a.submitted_count+"</td>",o+="<td>"+a.conversion_rate+"%</td>",o+="<td>"+a.abandoned_count+"</td>",o+="<td>"+a.abandonment_rate+"%</td>",o+="<td>"+a.bounce_rate+"%</td>",u+=o+="</tr>"}),a.find("tfoot").html(u)},populateSummaryTablePagination:function(){for(var a=t.data.summaryCurrentPage,e=t.responseData.form_summary,o=t.data.summaryLimit,s=e.length,i=Math.ceil(s/o),n="",d=0;d<i;d++){var l=d+1;n+='<a class="button urfa-summary-table-pagination-link '+(a==l?"disabled":"")+'" href="#" data-page="'+l+'">'+l+"</a>"}r(".user-registration-form-summary .tablenav-pages").html(n),r(".user-registration-form-summary .tablenav-pages").find(".urfa-summary-table-pagination-link").on("click",function(a){a.preventDefault(),a.stopPropagation();var e=r(a.target).data("page");e!=t.getState("summaryCurrentPage")&&(t.updateState({summaryCurrentPage:e},!1),t.populateSummaryTable())})},updateState:function(a,e){e===undefined&&(e=!0);var o=!1;r.each(a,function(r,a){t.data[r]!==a&&(t.data[r]=a,o=!0)}),o&&e&&t.dashboard_load_event()},getState:function(r){return"undefined"!=typeof t.data[r]&&t.data[r]},specific_registration_source_chart:function(a){r(".user-registration-registration-source-report").html(a.message);var e=a,o=r(document).find("#user-registration-pro-specific-form-registration-overview-chart-report-area"),s=Object.keys(e.specific_form_registration).sort(),i=[],n=[];s.forEach(function(r){i.push(e.specific_form_registration),n.push(e.specific_form_registration[r])});for(var d=[],l=0;l<s.length;l++)d.push(t.getRandomColor());var u={datasets:[{backgroundColor:d,data:n}],labels:s},c=new Chart(o,{type:"doughnut",data:u,options:{responsive:!0,legend:{display:!1},legendCallback:function(r){var a=[];a.push('<ul class="user-registration-pro-legend-'+r.id+' ur-d-flex ur-flex-wrap ur-mt-3 ur-mb-0">');for(var t=0;t<r.data.labels.length;t++)a.push('<li><span class="user-registration-pro-color-tag" style="background-color:'+r.data.datasets[0].backgroundColor[t]+'"></span>'),r.data.labels[t]&&a.push(r.data.labels[t]),a.push("</li>");return a.push("</ul>"),a.join("")}}});r(".user-registration-specific-registration-chart").find(".user-registration-pro-specific-form-registration-overview-chart-report-legends").html(c.setDatasetVisibility(1,!0))},getRandomColor:function(){for(var r="#",a=0;a<6;a++)r+="0123456789ABCDEF"[Math.floor(16*Math.random())];return r}};t.init(),a(r(".user-registration-pro-select-popup-type")),r("select[name='user_registration_pro_popup_type']").on("change",function(){a(r(this))})});